{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/local-context7/manifest.schema.json",
  "title": "Documentation Manifest",
  "description": "Schema for local-context7 documentation source manifests",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this schema for IDE validation"
    },
    "_source": {
      "type": "object",
      "description": "Source configuration for fetching documentation",
      "oneOf": [
        { "$ref": "#/$defs/githubSource" },
        { "$ref": "#/$defs/urlSource" }
      ]
    },
    "files": {
      "type": "object",
      "description": "URL entries for URL-type manifests. Keys become directory paths, leaf strings are URLs.",
      "additionalProperties": {
        "$ref": "#/$defs/urlEntries"
      }
    }
  },
  "required": ["_source"],
  "additionalProperties": false,
  "allOf": [
    {
      "if": {
        "properties": {
          "_source": {
            "properties": { "type": { "const": "url" } },
            "required": ["type"]
          }
        }
      },
      "then": {
        "required": ["_source", "files"]
      }
    }
  ],
  "$defs": {
    "githubSource": {
      "type": "object",
      "description": "Fetch documentation from a GitHub repository",
      "properties": {
        "type": {
          "const": "github"
        },
        "repo": {
          "type": "string",
          "description": "GitHub repository in 'owner/repo' format",
          "pattern": "^[a-zA-Z0-9_.-]+/[a-zA-Z0-9_.-]+$",
          "examples": ["vercel/next.js", "colinhacks/zod"]
        },
        "branch": {
          "type": "string",
          "description": "Git branch to fetch from",
          "default": "main",
          "examples": ["main", "master", "canary", "docs"]
        },
        "path": {
          "type": "string",
          "description": "Path to documentation directory within the repo",
          "default": ".",
          "examples": ["docs", "content", "packages/docs/content"]
        },
        "extensions": {
          "type": "array",
          "description": "File extensions to include",
          "items": {
            "type": "string",
            "pattern": "^\\.[a-zA-Z0-9]+$"
          },
          "default": [".md", ".mdx"],
          "examples": [[".md", ".mdx"], [".md"]]
        },
        "exclude": {
          "type": "array",
          "description": "Glob patterns to exclude files",
          "items": {
            "type": "string"
          },
          "examples": [["**/internal/**", "CHANGELOG*"]]
        },
        "noDefaultExcludes": {
          "type": "boolean",
          "description": "Disable default exclude patterns (CHANGELOG, CONTRIBUTING, etc.)",
          "default": false
        },
        "_disabled": {
          "type": "boolean",
          "description": "Skip processing this manifest",
          "default": false
        },
        "_reason": {
          "type": "string",
          "description": "Reason for disabling this manifest"
        }
      },
      "required": ["type", "repo"],
      "additionalProperties": false
    },
    "urlSource": {
      "type": "object",
      "description": "Fetch documentation from URLs",
      "properties": {
        "type": {
          "const": "url"
        },
        "convert": {
          "type": "string",
          "enum": ["html"],
          "description": "Convert HTML pages to markdown (requires pandoc). Note: Does not work for SPA sites."
        },
        "_disabled": {
          "type": "boolean",
          "description": "Skip processing this manifest",
          "default": false
        },
        "_reason": {
          "type": "string",
          "description": "Reason for disabling this manifest"
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "urlEntries": {
      "description": "Nested structure of URL entries. Keys become directory paths, leaf strings are URLs.",
      "oneOf": [
        {
          "type": "string",
          "format": "uri",
          "description": "URL to a documentation file"
        },
        {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/urlEntries"
          }
        }
      ]
    }
  },
  "examples": [
    {
      "$schema": "./manifest.schema.json",
      "_source": {
        "type": "github",
        "repo": "vercel/next.js",
        "branch": "canary",
        "path": "docs",
        "extensions": [".md", ".mdx"]
      }
    },
    {
      "$schema": "./manifest.schema.json",
      "_source": { "type": "url", "convert": "html" },
      "files": {
        "getting-started": {
          "installation": "https://example.com/docs/install.html"
        }
      }
    }
  ]
}
